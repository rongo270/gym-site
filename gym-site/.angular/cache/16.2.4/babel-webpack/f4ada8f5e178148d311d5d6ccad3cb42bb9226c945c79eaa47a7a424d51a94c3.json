{"ast":null,"code":"var _class;\nimport { BehaviorSubject } from 'rxjs';\nimport jwt_decode from 'jwt-decode';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../products/products.service\";\nimport * as i2 from \"@angular/router\";\nexport class CartService {\n  constructor(productsService, router) {\n    this.productsService = productsService;\n    this.router = router;\n    this.cartItems = [];\n    this.cartItemsSubject = new BehaviorSubject([]);\n    // Initialize the cart from local storage if available\n    const storedCart = localStorage.getItem('shoppingCart');\n    if (storedCart) {\n      this.cartItems = JSON.parse(storedCart);\n      this.cartItemsSubject.next(this.cartItems);\n    }\n  }\n  getCartItems() {\n    return this.cartItemsSubject;\n  }\n  addToCart(product) {\n    this.cartItems.push(product);\n    this.cartItemsSubject.next(this.cartItems);\n    this.saveCartToLocalStorage();\n  }\n  removeFromCart(productId, product) {\n    let itemRemoved = false;\n    this.cartItems = this.cartItems.filter(item => {\n      if (!itemRemoved && item.id === productId) {\n        itemRemoved = true; // Set the flag to true\n        return false; // Remove the first item with the matching id\n      }\n\n      return true; // Keep all other items\n    });\n\n    this.productsService.updateProduct(productId, product).subscribe({\n      next: product => {\n        this.router.navigate(['products']); //routet back to products page\n      },\n\n      error: respose => {\n        console.log(respose);\n      }\n    });\n    this.cartItemsSubject.next(this.cartItems);\n    this.saveCartToLocalStorage();\n  }\n  clearCart() {\n    this.cartItems = [];\n    this.cartItemsSubject.next(this.cartItems);\n    this.clearCartFromLocalStorage();\n  }\n  saveCartToLocalStorage() {\n    localStorage.setItem('shoppingCart', JSON.stringify(this.cartItems));\n  }\n  clearCartFromLocalStorage() {\n    localStorage.removeItem('shoppingCart');\n  }\n  updateCartInToken(newCartData) {\n    const token = localStorage.getItem('jwt_token');\n    if (token) {\n      const decodedToken = jwt_decode(token);\n      decodedToken.cart = newCartData;\n      localStorage.setItem('jwt_token', JSON.stringify(decodedToken));\n    } else {}\n  }\n}\n_class = CartService;\n_class.ɵfac = function CartService_Factory(t) {\n  return new (t || _class)(i0.ɵɵinject(i1.ProductsService), i0.ɵɵinject(i2.Router));\n};\n_class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: _class,\n  factory: _class.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"names":["BehaviorSubject","jwt_decode","CartService","constructor","productsService","router","cartItems","cartItemsSubject","storedCart","localStorage","getItem","JSON","parse","next","getCartItems","addToCart","product","push","saveCartToLocalStorage","removeFromCart","productId","itemRemoved","filter","item","id","updateProduct","subscribe","navigate","error","respose","console","log","clearCart","clearCartFromLocalStorage","setItem","stringify","removeItem","updateCartInToken","newCartData","token","decodedToken","cart","i0","ɵɵinject","i1","ProductsService","i2","Router","factory","ɵfac","providedIn"],"sources":["C:\\angular\\gym-site\\src\\Service\\cart\\cart.service.ts"],"sourcesContent":["// cart.service.ts\nimport { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { product } from '../../models/product.model';\r\nimport jwt_decode from 'jwt-decode';\r\nimport { ProductsService } from '../products/products.service';\r\nimport { Router } from '@angular/router';\r\n\r\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class CartService {\n  private cartItems: product[] = [];\n  private cartItemsSubject = new BehaviorSubject<product[]>([]);\n\n  constructor(private productsService: ProductsService, private router: Router) {\n    // Initialize the cart from local storage if available\n    const storedCart = localStorage.getItem('shoppingCart');\n    if (storedCart) {\n      this.cartItems = JSON.parse(storedCart);\n      this.cartItemsSubject.next(this.cartItems);\n    }\n  }\n\n  getCartItems(): BehaviorSubject<product[]> {\n    return this.cartItemsSubject;\n  }\n\n  addToCart(product: product): void {\n    this.cartItems.push(product);\n    this.cartItemsSubject.next(this.cartItems);\n    this.saveCartToLocalStorage();\n  }\n\n  removeFromCart(productId: string, product: product): void {\r\n    let itemRemoved = false;\r\n\r\n    this.cartItems = this.cartItems.filter((item) => {\r\n      if (!itemRemoved && item.id === productId) {\r\n        itemRemoved = true; // Set the flag to true\r\n        return false; // Remove the first item with the matching id\r\n      }\r\n      return true; // Keep all other items\r\n    });\r\n    this.productsService.updateProduct(productId, product).subscribe({\r\n      next: (product) => {\r\n        this.router.navigate(['products']);//routet back to products page\r\n      },\r\n      error: (respose) => {\n        console.log(respose);\n      }\r\n    })\r\n    this.cartItemsSubject.next(this.cartItems);\r\n    this.saveCartToLocalStorage();\r\n  }\r\n\n\n  clearCart(): void {\n    this.cartItems = [];\n    this.cartItemsSubject.next(this.cartItems);\n    this.clearCartFromLocalStorage();\n  }\n\n  private saveCartToLocalStorage(): void {\n    localStorage.setItem('shoppingCart', JSON.stringify(this.cartItems));\n  }\n\n  private clearCartFromLocalStorage(): void {\n    localStorage.removeItem('shoppingCart');\n  }\n\n  updateCartInToken(newCartData: product[]): void {\r\n    const token = localStorage.getItem('jwt_token');\r\n    if (token) {\r\n      const decodedToken: any = jwt_decode(token);\r\n      decodedToken.cart = newCartData;\r\n      localStorage.setItem('jwt_token', JSON.stringify(decodedToken));\r\n    } else {\r\n    }\r\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}